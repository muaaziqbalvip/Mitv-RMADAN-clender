<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MI RAMADAN PRO | ICS SCIENCE EXPERT EDITION</title>
    <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ffcc33">
<meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="icon" type="image/png" href="https://i.ibb.co/rKM2mKWt/1771605401569.png">
<link rel="apple-touch-icon" href="https://i.ibb.co/rKM2mKWt/1771605401569.png">

    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Poppins:wght@100;300;400;600;800&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>

    <style>
        /* ================================================
           MEGA CSS ARCHITECTURE (MOBILE OPTIMIZED)
           ================================================
        */
        :root {
            --gold: #ffcc33;
            --dark-bg: #010409;
            --card-bg: rgba(13, 17, 23, 0.85);
            --neon-green: #39ff14;
            --neon-red: #ff3131;
            --text-main: #e6edf3;
            --mi-gradient: linear-gradient(145deg, #0d1117, #010409);
        }

        * {
            margin: 0; padding: 0; box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-main);
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
            width: 100%;
        }

        /* Live Ramadan Particles Background */
        #aura-canvas {
            position: fixed; top: 0; left: 0; z-index: -1; width: 100%; height: 100%;
        }

        /* High-End Header Bar */
        .mi-header {
            width: 100%; height: 75px; background: rgba(1, 4, 9, 0.9);
            backdrop-filter: blur(15px); border-bottom: 2px solid var(--gold);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px; position: sticky; top: 0; z-index: 1000;
        }

        .mi-logo {
            font-family: 'Orbitron', sans-serif; font-weight: 900;
            font-size: 1.4rem; color: var(--gold); text-shadow: 0 0 10px rgba(255,204,51,0.5);
        }

        /* Mobile Responsive Grid System */
        .main-container {
            width: 100%; padding: 15px; display: none; /* Permission based */
            max-width: 600px; margin: 0 auto; padding-bottom: 120px;
        }

        /* Advanced Clock Display */
        .hero-section {
            background: var(--mi-gradient); border-radius: 25px;
            padding: 30px 15px; border: 1px solid rgba(255,204,51,0.2);
            text-align: center; margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .timer-label {
            font-family: 'Orbitron'; font-size: 0.7rem; letter-spacing: 3px;
            color: var(--gold); text-transform: uppercase;
        }

        #countdown {
            font-family: 'Orbitron'; font-size: 3.5rem; font-weight: 900;
            color: #fff; text-shadow: 0 0 20px var(--gold); margin: 10px 0;
        }

        /* Quick Stats Grid */
        .stats-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--card-bg); padding: 20px; border-radius: 20px;
            text-align: center; border: 1px solid rgba(255,255,255,0.05);
            transition: 0.3s;
        }

        .stat-card:active { transform: scale(0.95); border-color: var(--gold); }
        .stat-card h5 { font-size: 0.6rem; color: var(--gold); text-transform: uppercase; margin-bottom: 8px; }
        .stat-card .val { font-family: 'Orbitron'; font-size: 1.2rem; font-weight: 700; }

        /* Prayer Times List (Mobile Style) */
        .prayer-list {
            background: var(--card-bg); border-radius: 25px; padding: 20px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .prayer-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .prayer-item:last-child { border-bottom: none; }
        .p-name { display: flex; align-items: center; gap: 10px; font-weight: 600; }
        .p-time { color: var(--gold); font-family: 'Orbitron'; font-size: 1rem; }

        /* Multi-Level Permission Overlay */
        #mi-gate {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--dark-bg); z-index: 2000;
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; padding: 30px; text-align: center;
        }

        .gate-content {
            background: var(--card-bg); border: 2px solid var(--gold);
            padding: 40px 20px; border-radius: 35px; width: 100%;
            animation: slideUp 0.8s ease;
        }

        .btn-activate {
            background: var(--gold); color: #000; border: none;
            padding: 18px 40px; border-radius: 50px; font-weight: 900;
            font-family: 'Orbitron'; margin-top: 30px; cursor: pointer;
            width: 100%; box-shadow: 0 0 20px rgba(255,204,51,0.4);
        }

        /* Fixed Footer (Social & Dev) */
        .mi-footer-fixed {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(1, 4, 9, 0.95); border-top: 2px solid var(--gold);
            padding: 12px 15px; z-index: 1001;
        }

        .dev-tag {
            font-size: 0.65rem; color: var(--gold); font-weight: 800;
            text-align: center; margin-bottom: 8px; font-family: 'Orbitron';
        }

        .social-row {
            display: flex; justify-content: space-around; font-size: 1.2rem;
        }

        .social-row a { color: #fff; transition: 0.3s; }
        .social-row a:hover { color: var(--gold); }

        /* Full Calendar Overlay */
        #calendar-view {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--dark-bg); z-index: 1500; display: none;
            overflow-y: auto; padding: 20px; padding-bottom: 100px;
        }

        .cal-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.8rem; }
        .cal-table th { background: var(--gold); color: #000; padding: 10px; }
        .cal-table td { padding: 12px 8px; border-bottom: 1px solid #222; text-align: center; }

        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
/* Header Time Box Styling */
.header-right-side {
    display: flex;
    align-items: center;
    gap: 12px;
}

.mi-header-clock {
    background: rgba(255, 204, 51, 0.15);
    border: 1px solid var(--gold);
    padding: 5px 12px;
    border-radius: 8px;
    font-family: 'Orbitron', sans-serif;
    color: var(--gold);
    font-size: 0.85rem;
    font-weight: 700;
    box-shadow: 0 0 10px rgba(255, 204, 51, 0.2);
    min-width: 90px;
    text-align: center;
}

/* Mobile adjust for long headings */
@media (max-width: 400px) {
    .mi-logo { font-size: 1.1rem; }
    .mi-header-clock { font-size: 0.75rem; padding: 4px 8px; min-width: 75px; }
}

    </style>
</head>
<body>

    <canvas id="aura-canvas"></canvas>

    <div id="mi-gate">
        <div class="gate-content">
            <h1 style="color: var(--gold); font-family: 'Orbitron';">MI RAMADAN CLENDER</h1>
            <p style="margin: 20px 0; font-size: 0.9rem; line-height: 1.6; opacity: 0.8;">
                Assalam-o-Alaikum ALL VIEWERS KO Muaaz Iqbal! KI TRAF SE RMADAN MUBARAK.<br>
                For Precise Location Timings & Loud Alarms, we need your permission.
            </p>
            <button class="btn-activate" onclick="startEngine()">GRANT ACCESS</button>
        </div>
    </div>

    <header class="mi-header">
    <div class="mi-logo">üÖºüÖ∏‚Ñ¢ ùó•ùóîùó†ùóîùóóùóîùó°</div>
    
    <div class="header-right-side">
        <div class="mi-header-clock" id="header-live-clock">00:00:00</div>
        
        <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 4px;">
            <i class="fas fa-bell" id="alarm-icon" style="color: var(--gold); font-size: 0.9rem;"></i>
            <span id="loc-tag" style="font-size: 0.5rem; background: rgba(255,204,51,0.2); padding: 2px 6px; border-radius: 4px; border: 0.5px solid var(--gold);">SYNCING</span>
        </div>
    </div>
</header>


    <div class="main-container" id="main-ui">
        
        <div class="hero-section">
            <div class="timer-label" id="timer-title">Next Event Loading...</div>
            <div id="countdown">00:00:00</div>
            <div id="hijri-box" style="font-family: 'Amiri'; color: var(--gold); font-size: 1.4rem;">-- Ramadan 1447</div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h5>ROZE GUZRE</h5>
                <div class="val" id="count-done">--</div>
            </div>
            <div class="stat-card" onclick="toggleCalendar(true)">
                <h5>ROZE BAQI</h5>
                <div class="val" id="count-left" style="color: var(--gold);">--</div>
                <small style="font-size: 0.5rem; display: block; margin-top: 5px;">VIEW CALENDAR</small>
            </div>
            <div class="stat-card">
                <h5>SEHRI (FAJR)</h5>
                <div class="val" id="sehri-val" style="color: var(--neon-green);">--:--</div>
            </div>
            <div class="stat-card">
                <h5>IFTAR (MAGHRIB)</h5>
                <div class="val" id="iftar-val" style="color: var(--neon-red);">--:--</div>
            </div>
        </div>

        <div class="prayer-list">
            <h4 style="font-family: 'Orbitron'; font-size: 0.8rem; margin-bottom: 15px; border-left: 3px solid var(--gold); padding-left: 10px;">TODAY'S NAMAZ</h4>
            <div id="prayer-items-box">
                </div>
        </div>

    </div>

    <div class="mi-footer-fixed">
        <div class="dev-tag">DEVELOPED BY ùêåùêîùêÄùêÄùêô ùêàùêêùêÅùêÄùêã | ICS SCIENCE EXPERT</div>
        <div class="social-row">
            <a href="https://whatsapp.com/channel/0029VbBxejr4tRryT1wVqu0D"><i class="fab fa-whatsapp"></i></a>
            <a href="https://t.me/MITV_NETWORK"><i class="fab fa-telegram"></i></a>
            <a href="https://m.youtube.com/@muslimislamofficial"><i class="fab fa-youtube"></i></a>
            <a href="https://www.facebook.com/share/14Xf5k1kc2J/"><i class="fab fa-facebook"></i></a>
        </div>
    </div>

    <div id="calendar-view">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h2 style="color: var(--gold); font-family: 'Orbitron';">FULL CALENDAR</h2>
            <button onclick="toggleCalendar(false)" style="background: none; border: 1px solid var(--gold); color: #fff; padding: 5px 15px; border-radius: 20px;">CLOSE</button>
        </div>
        <table class="cal-table">
            <thead>
                <tr>
                    <th>RAMADAN</th>
                    <th>DATE</th>
                    <th>SEHRI</th>
                    <th>IFTAR</th>
                </tr>
            </thead>
            <tbody id="cal-body"></tbody>
        </table>
    </div>

    <audio id="alarm-audio" src="https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg" preload="auto"></audio>

    <script>
        /* ================================================
           MEGA JAVASCRIPT ENGINE (800+ LINES LOGIC)
           ================================================
        */

        let userLat, userLon;
        let apiData = null;
        let calendarData = null;
        const alarmNode = document.getElementById('alarm-audio');

        // 1. Core Start Engine
        async function startEngine() {
            // Mobile Volume/Alarm Permission Trick
            alarmNode.play().then(() => {
                alarmNode.pause();
                alarmNode.currentTime = 0;
            }).catch(e => console.log("Audio unlock needed"));

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async (pos) => {
                    userLat = pos.coords.latitude;
                    userLon = pos.coords.longitude;
                    document.getElementById('mi-gate').style.display = 'none';
                    document.getElementById('main-ui').style.display = 'block';
                    await syncData();
                    initVisuals();
                    setInterval(heartbeat, 1000);
                }, () => {
                    alert("Location denied! Setting default to Kasur, Pakistan.");
                    userLat = 31.11; userLon = 74.44;
                    document.getElementById('mi-gate').style.display = 'none';
                    document.getElementById('main-ui').style.display = 'block';
                    syncData();
                    initVisuals();
                    setInterval(heartbeat, 1000);
                });
            }
        }

        // 2. Data Synchronization (Today + Month)
        async function syncData() {
            try {
                const todayRes = await fetch(`https://api.aladhan.com/v1/timings?latitude=${userLat}&longitude=${userLon}&method=1`);
                const todayJson = await todayRes.json();
                apiData = todayJson.data;

                const monthRes = await fetch(`https://api.aladhan.com/v1/calendar/2026/2?latitude=${userLat}&longitude=${userLon}&method=1`);
                const monthJson = await monthRes.json();
                calendarData = monthJson.data;

                updateUI();
                renderCalendar();
            } catch (err) {
                console.log("Sync Error");
            }
        }

        // 3. Time Formatter 12H
        function format12(t) {
            if(!t) return "--:--";
            let [h, m] = t.split(':');
            let ampm = h >= 12 ? 'PM' : 'AM';
            h = h % 12 || 12;
            return `${h}:${m} ${ampm}`;
        }

        // 4. Update Interface
        function updateUI() {
            const t = apiData.timings;
            document.getElementById('loc-tag').innerText = apiData.meta.timezone.split('/')[1] || "SYNCED";
            document.getElementById('sehri-val').innerText = format12(t.Fajr);
            document.getElementById('iftar-val').innerText = format12(t.Maghrib);
            document.getElementById('hijri-box').innerText = `${apiData.date.hijri.day} ${apiData.date.hijri.month.en} ${apiData.date.hijri.year}`;

            // Fasting Progress (Ramadan 2026 starts approx Feb 18)
            const startDate = new Date('2026-02-18');
            const diff = Math.floor((new Date() - startDate) / (1000*60*60*24));
            const done = diff > 0 ? (diff > 30 ? 30 : diff) : 0;
            document.getElementById('count-done').innerText = done;
            document.getElementById('count-left').innerText = 30 - done;

            // Prayer List Rendering
            const pList = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
            let html = '';
            pList.forEach(p => {
                html += `
                <div class="prayer-item">
                    <div class="p-name"><i class="far fa-clock" style="color:var(--gold)"></i> ${p}</div>
                    <div class="p-time">${format12(t[p])}</div>
                </div>`;
            });
            document.getElementById('prayer-items-box').innerHTML = html;
        }

        // 5. Calendar Modal Logic
        function renderCalendar() {
            let html = '';
            calendarData.forEach((day, i) => {
                html += `
                <tr>
                    <td>${i+1}</td>
                    <td>${day.date.readable}</td>
                    <td style="color:var(--neon-green)">${format12(day.timings.Fajr.split(' ')[0])}</td>
                    <td style="color:var(--neon-red)">${format12(day.timings.Maghrib.split(' ')[0])}</td>
                </tr>`;
            });
            document.getElementById('cal-body').innerHTML = html;
        }

        function toggleCalendar(show) {
            document.getElementById('calendar-view').style.display = show ? 'block' : 'none';
        }

        // 6. Real-time Heartbeat (Countdown & Alarm)
        /* ================================================
   CORE HEARTBEAT ENGINE - FULL ACTION LOGIC
   ================================================
*/
function heartbeat() {
    if (!apiData) return;

    const now = new Date();
    
    // --- PART 1: 12-HOUR HEADER CLOCK LOGIC ---
    let hours = now.getHours();
    let minutes = now.getMinutes();
    let seconds = now.getSeconds();
    let ampm = hours >= 12 ? 'PM' : 'AM';
    
    hours = hours % 12;
    hours = hours ? hours : 12; // 0 ko 12 banana
    
    const hStr = hours.toString().padStart(2, '0');
    const mStr = minutes.toString().padStart(2, '0');
    const sStr = seconds.toString().padStart(2, '0');
    
    // Header mein live time update
    document.getElementById('header-live-clock').innerText = `${hStr}:${mStr}:${sStr} ${ampm}`;

    // --- PART 2: LOUD ALARM TRIGGER SYSTEM ---
    // API times usually 24h format mein hoti hain (e.g., "05:15")
    const currentTime24 = now.getHours().toString().padStart(2, '0') + ":" + mStr;
    
    const sehriTime = apiData.timings.Fajr;
    const iftarTime = apiData.timings.Maghrib;

    // Check for exact second to trigger alarm
    if ((currentTime24 === sehriTime || currentTime24 === iftarTime) && seconds === 0) {
        triggerLoudAlarm();
    }

    // --- PART 3: DYNAMIC COUNTDOWN ENGINE ---
    updateCountdownLogic(now, sehriTime, iftarTime);
}

// Sub-function for Loud Alarm
function triggerLoudAlarm() {
    const alarmNode = document.getElementById('alarm-audio');
    alarmNode.volume = 1.0; // Full Loud
    alarmNode.play().catch(e => console.log("User interaction required for audio"));
    
    // Visual Alert
    document.getElementById('alarm-icon').style.animation = "pulse 0.5s infinite";
    setTimeout(() => {
        document.getElementById('alarm-icon').style.animation = "none";
    }, 60000);
}

// Sub-function for Countdown Calculation
function updateCountdownLogic(now, sT_raw, iT_raw) {
    const sParts = sT_raw.split(':');
    const iParts = iT_raw.split(':');
    
    const sehriDate = new Date(); 
    sehriDate.setHours(sParts[0], sParts[1], 0);
    
    const iftarDate = new Date(); 
    iftarDate.setHours(iParts[0], iParts[1], 0);

    let target, label;

    if (now < sehriDate) {
        target = sehriDate;
        label = "Sehri Ends In";
    } else if (now < iftarDate) {
        target = iftarDate;
        label = "Iftar Starts In";
    } else {
        target = new Date(sehriDate);
        target.setDate(target.getDate() + 1);
        label = "Next Sehri In";
    }

    const diff = target - now;
    const h = Math.floor(diff / 3600000);
    const m = Math.floor((diff % 3600000) / 60000);
    const s = Math.floor((diff % 60000) / 1000);

    // Main Hero Section Update
    document.getElementById('countdown').innerText = 
        `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    document.getElementById('timer-title').innerText = label;
}

        // 7. Live Ramadan Aura (Particles)
        function initVisuals() {
            const canvas = document.getElementById('aura-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const particles = [];
            for(let i=0; i<100; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 2,
                    speed: Math.random() * 0.5,
                    opacity: Math.random()
                });
            }

            function animate() {
                ctx.clearRect(0,0, canvas.width, canvas.height);
                ctx.fillStyle = "#ffcc33";
                particles.forEach(p => {
                    ctx.globalAlpha = p.opacity;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
                    ctx.fill();
                    p.y -= p.speed;
                    if(p.y < 0) p.y = canvas.height;
                });
                requestAnimationFrame(animate);
            }
            animate();
        }
// Register Service Worker for PWA
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js')
      .then(reg => console.log('MI RAMADAN PWA Registered!'))
      .catch(err => console.log('Registration Failed: ', err));
  });
}

// Add to Home Screen Prompt Logic
let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  // Yahan tum chaho to koi button dikha sakte ho "Install App" ka
});

    </script>
</body>
</html>
